{
  "kind": "build_request",
  "title": "Switch to hash-based routing for ICP static hosting and fix Vite base path",
  "projectName": "EcoPowerHub AI",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the frontend routing to use hash-based URLs (e.g., /#/dashboard) so page refreshes and deep-links work on ICP asset canisters without server-side rewrites. Implement this using the existing TanStack Router setup (not react-router-dom), configuring the router to use hash history.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Fix routing – switch to HashRouter (easiest for ICP static assets)\n...\nHashRouter uses # in URLs (e.g. /#/dashboard) – no server rewrites needed, perfect for ICP asset canisters."
        ]
      },
      "acceptanceCriteria": [
        "Navigating to any existing route (e.g., dashboard, diagnostics, tech-specs) results in URLs that include a hash fragment (e.g., /#/dashboard).",
        "Directly loading a deep link with a hash route (e.g., https://<canister-domain>/#/dashboard) renders the expected page instead of a blank/404 page.",
        "All existing routes defined in frontend/src/App.tsx continue to work without changing their path strings."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Adjust the Vite build configuration to use relative asset paths for ICP static hosting by setting Vite base to './' (and keep production build compatibility).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Try:\n... base: './',  // ← relative paths – often fixes asset loading on ICP"
        ]
      },
      "acceptanceCriteria": [
        "frontend/vite.config.ts sets base to './'.",
        "After running the production build, the generated dist/index.html references JS/CSS assets using relative paths that load correctly when hosted from an ICP asset canister."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add a user-visible top-level error fallback so unexpected runtime errors during app/router rendering do not appear as a blank white screen. Use existing in-repo fallback components where possible and keep user-facing text in English.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Bonus: Add error boundary & fallback\n...\nThis should bring back the globe / content"
        ]
      },
      "acceptanceCriteria": [
        "If an exception is thrown during initial route rendering, the app shows an on-screen error message and at least one recovery action (e.g., reload or navigate home) instead of a blank screen.",
        "Normal routing and page rendering behavior is unchanged when no error occurs.",
        "All user-visible error text is in English."
      ]
    }
  ],
  "constraints": [
    "Do not edit immutable frontend files: frontend/src/main.tsx, frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/components/ui/**.",
    "Keep all backend logic in the single Motoko actor (no backend changes required for this request)."
  ],
  "nonGoals": [
    "Implementing clean (non-hash) URLs with server-side rewrite rules on ICP.",
    "Changing the existing route paths or adding new product features unrelated to routing/build stability."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}